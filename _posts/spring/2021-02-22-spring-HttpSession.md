---
title:  "[Spring] HttpSession"
excerpt: "HttpSession 개념 정리"

categories:
  - Spring
tags:
  - [Java, Spring, HttpSession]

toc: true
classes: wide

sidebar:
  nav: "docs"
 
date: 2021-02-22
last_modified_at: 2021-02-22
---

### HttpSession이란?
---
HttpSession은 로그인 처리할 때 유용하게 쓰인다.<br>
클라이언트의 상태값을 서버측에 저장하고 HttpSession을 이용해서 객체를 관리합니다.<br>
따라서 사용자는 브라우저 별로 별도의 쿠키를 가지고 접근하고, 서버의 내부에 필요한 객체를 보관하기 때문에 안전하다는 장점을 가지고 있습니다.

### 장단점
---
장점
- 관리할 수 있는 상태값(클라이언트 데이터)의 종류나 크기나 개수의 제한이 없습니다.
- 서버에 저장되므로 cookie에 비해 보안상 유리합니다.

단점
- 서버에 부담줍니다.

### 동작 방식 TMI
---
서버에서 세션을 사용 설정한 경우, 클라이언트가 해당 서버에 접속할 때 서버에는 세션 파일을 하나 생성합니다.<br>
그리고 서버는 브라우저에게 JSESSIONID라는 쿠키를 전송합니다.(해당 쿠키 명은 변경할 수 있습니다.)<br>
이제 브라우저는 다른 페이지로 이동할 때마다, JSESSIONID를 서버로 함께 전송합니다.<br>
그럼 서버는 JSESSIONID 쿠키 값을 보고 A 브라우저는 A 세션이 매칭 되어있구나,라고 하고 어떤 사용자인지 체크할 수 있습니다.<br>
브라우저마다 세션 값이 겹치지 않는 이유는 브라우저 별로 별도의 쿠키를 관리하며, 쿠키를 별도로 관리하기 때문에 서버 입장에서는 같은 사용자로 인식할 수 없습니다.<br>
로그인 기능을 만들더라도 다른 브라우저에서 같은 아이디로 접속하게 되더라도 JSESSIONID는 전혀 달라지게 됩니다.

### 메소드
---

|타입|메소드|설명|
|:----:|:----:|:----|
|java.lang.Object|getAttribute(String name)|세션 속성명이 name인 속성의 값을 Object 타입으로 리턴합니다.<br>해당 되는 속성명이 없을 경우에는 null 값을 리턴합니다.|
|java.util.Enumeration|getAttributeNames()|세션 속성의 이름들을 Enumeration 객체 타입으로 리턴합니다.|
|long|getCreationTime()|1970년 1월 1일 0시 0초를 기준으로 하여 현재 세션이 생성된 시간까지 경과한 시간을 계산하여 1/1000초 값으로 리턴합니다.|
|java.lang.String|getId()|세션에 할당된 고유 식별자를 String 타입으로 리턴합니다.|
|int|getMaxInactiveInterval()|현재 생성된 세션을 유지하기 위해 설정된 세션 유지시간을 int형으로 리턴합니다.|
|void|invalidate()|현재 생성된 세션을 무효화 시킵니다.|
|void|removeAttribute(String.name)|세션 속성명이 name인 속성을 제거합니다.<br>ex) 로그아웃을 할 경우 사용합니다.|
|void|setAttribute(String name, Object value)|세션 속성명이 name인 속성에 속성값으로 value를 할당합니다.|
|void|setMaxInactiveInterval(int interval)|세션을 유지하기 위한 세션 유지시간을 초 단위로 설정합니다.<br>즉, Client가 Second 만큼 동안 요청이 들어오지 않으면 Session을 소멸합니다.|

### TMI
---
왜 세션 방식으로 사용자를 구별할까요?<br>
우선 HTTP의 경우 클라이언트가 서버를 호출(url에 따라 특정 페이지를 호출)하고 연결이 끊어집니다.<br>
그럼 클라이언트가 다른 페이지로 넘어갈 때 서버는 이 클라이언트가 방금 전에 들어온 클라이언트인지, 다른데서 들어온 클라이언트인지를 확인 할 방법이 없습니다.<br>
그래서 웹 초기에는 대부분 쿠키를 통한 인증방식을 채택했습니다.(국내 기준)<br>
로그인(아이디/비밀번호)을 통해 인증을 하고, 해당 값을 클라이언트의 브라우저에 쿠키로 입력하고, 그 브라우저로 접속하게 되면 이 회원의 아이디/비밀번호 값을 쿠키를 통해 알 수 있으니까요.<br>
대신 여기서 보안적인 문제가 발생합니다.<br>
로그인을 하고 로그아웃을 하면 괜찮은데, 대부분의 사용자들이 로그아웃을 하지 않고 브라우저를 종료하게 되는데, 쿠키는 각 클라이언트의 브라우저에 저장이 되기 때문에 PC 방 등 여러사람이 이용하는 곳에선 브라우저 내의 쿠키를 확인해서 아이디와 비밀번호를 볼 수 있기 때문에 해킹 문제가 있었죠.<br>
그래서 결국 세션을 이용해서 중요 데이터는 서버가 관리하고, 그 세션의 ID 값(기본키)을 클라이언트의 브라우저에 전달하여 인증을 구현하고 있습니다.<br>

세션도 보안적인 문제가 있긴합니다.<br>
Session Hijacking(세션 탈취)이라는 공격기법이 있는데 실제 사용하는 클라이언트의 브라우저의 쿠키를 확인하여 세션 ID를 탈취하고 해커는 자신의 브라우저에 세션 ID를 쿠키로 입력하게 되면, 서버는 실제 사용자인지 해커인지 분간할 수 없게되어 세션을 제공해줍니다.(로그인 되어있던 세션이라면, 해커도 로그인이 됩니다.)<br>
이를 막는 방법은 로그인을 할 때 특정할 수 있는 정보(IP, Useragent 등)를 세션에 함께 저장하고, 페이지를 넘어갈 때마다 체크를 하는 방법이 있습니다.

```
[참고한 사이트]
https://okky.kr/article/498323
https://gap85.tistory.com/entry/JSP-%EC%84%B8%EC%85%98
https://tsop.tistory.com/15
```

```
공부하고 참고하여 기록해두는 개인 기록용 포스팅입니다!
🤔 부족한 부분이 많으니 감안하여 봐주시길 바랍니다. 🤔
```